---
layout: post-vui
title: Игра «Охота на Вампуса»
summary: 
date: 2021-10-30 00:00
category: vui
permalink: /vui/wumpus/
---
![Охота на Вампуса](/images/posts/wumpus-cover.jpg)

В 1972 году Грегори Йоб написал классическую текстовую игру Hunt the Wumpus. <br>
50 лет спустя я сделал её <a href ="https://alice.ya.ru/s/03d361af-8c50-449a-9ab9-b61df7c67660" target="_blank">голосовой ремейк для Алисы</a>. Получилось эпично и с юмором.

## О чем был оригинал

![Обложка](/images/posts/wampus-poster.jpg)<br>
*<sub>Обложка оригинальной игры 1972 года</sub>*

<div class="note">
Сыграть в оригинального «Вампуса» можно здесь:<br><a href ="https://jayisgames.com/games/hunt-the-wumpus/" target="_blank">Hunt the Wumpus</a>.
</div>

Вампус — это жуткий монстр, обитающий в пещерах. Вонючий, шумный, с присосками. Задача игрока — выследить Вампуса и застрелить его.

Пещера Вампуса состоит из 20 комнат. Из каждой комнаты можно попасть в три других. Получается лабиринт в форме расплющенного додекаэдра, что добавляет ощущения дезориентации в пространстве. 

![Карта игры](/images/posts/Hunt_the_Wumpus_map.jpg)<br>
*<sub>Додекаэдр и его развертка с номерами комнат</sub>*

Помимо Вампуса в случайных комнатах находятся две ямы и две гигантских летучих мыши. От ям игрок погибает, а летучие мыши переносят его в другую случайную комнату. 

Если игрок окажется в одной комнате с Вампусом, то тот его съест. Поэтому убить Вампуса можно только выстрелом из соседней комнаты. В оригинальной игре 1972 года стрелы даже могли менять направление и бить на несколько комнат вперед.

Узнать о приближении Вампуса, ямы или летучей мыши можно было по запаху, сквозняку или шуму крыльев. Фраза «I smell a Wumpus» надолго засела в памяти детей того времени.

## Что изменилось с переходом «в голос»

<iframe width="772" height="450" src="https://www.youtube.com/embed/kCnmcz-3IYI" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

*<sub>Пример геймплея</sub>*

При создании навыка для Алисы я ориентировался как на смартфоны, так и на умные колонки. На экране отображается информация о комнатах, но игру можно пройти и без экрана — все обстановка озвучивается приятным мужским голосом. 

Об опасностях теперь можно узнать, прислушавшись к звукам в комнате — это помогает погрузиться в атмосферу. Зловещий рёв говорит о приближении Вампуса, рядом с ямами бушует сквозняк, а мыши пищат и хлопают крыльями. 

![Разные вступительные сообщения](/images/posts/wumpus-gameplay-1.jpg)
![Разные вступительные сообщения](/images/posts/wumpus-gameplay-2.jpg)<br>
*<sub>Главные команды: «иди» и «стреляй»</sub>*

Умные стрелы пришлось выбросить, т.к. их путь крайне тяжело просчитать, не видя перед собой карты. Но зато теперь стрелами можно прощупывать ямы и летучих мышей.

## Рассказчик

<div class="note">
Эрмил — мужской голос, входящий в состав <a href ="https://cloud.yandex.ru/services/speechkit" target="_blank">Yandex.SpeechKit</a>.
</div>

Т.к. в основе голосовых игр лежит диалог, я добавил в игру персону рассказчка. Он сопровождает игрока во время похода и комментирует происходящие события. Завораживающий голос Эрмила позволил составлять завораживающие реплики, звучащие не то из программы «В мире животных», не то с экрана загрузки третьего «Ведьмака».

Особое внимание уделено вступлению. Оно должно было создавать правильный настрой и не наскучить спустя несколько партий. Для этого я записал десяток разных реплик, вдохновляясь любимыми книгами и играми. 

![Разные вступительные сообщения](/images/posts/wumpus-start-1.jpg)
![Разные вступительные сообщения](/images/posts/wumpus-start-2.jpg)<br>
*<sub>Примеры вступительных реплик</sub>*

После прохождения определенного количества комнат рассказчик произносит какую-нибудь занятную реплику. Может похвалить игрока, рассказать байку или пожаловаться на холод в пещере. Это усиливает иллюзию общения и разбавляет монотонный процесс осмотра комнат.

В какой-то степени у рассказчика есть собственный характер. Интеллигентный, мечтательный, в меру ироничный. Надеюсь, что вы почувствуете это в его репликах.

## Звуки

Каждый звук в игре выполняет определенную функцию — предупреждают об опасности или задают атмосферу. Например, звук натяжения тетевы создает небольшую напряженную паузу между репликой игрока и оглашением результата выстрела.

Интересным решением стал звук зажигания факела в конце некоторых реплик рассказчика. С одной стороны, это добавило в игру больше контекста — в комнатах темно и сыро, поэтому нужно периодически обновлять факелы. С другой стороны, помогло отделить друг от друга несколько реплик рассказчика, не прибегая к длинным паузам (которые нужны пользователям для того, чтобы успеть осмыслить происходящее и подготовиться к следующей порции информации).

## Локации и сокровища

Перемещаться между безликими корридорами было скучно, поэтому каждую комнату я превратил в тематическую локацию. Их можно условно разделить на три части: первобытное общество, древний город и чудеса природы.

Открывая новую локацию, игрок может найти сокровище. В каждой игре их пять, но они всегда появляются в разных комнатах и тематически связаны со своими локациями. В тронном зале можно найти корону, а в амфитеатре - сценарий пьессы. Иногда попадается что-то абсурдное вроде грибов или золотого ёршика. Всего в игре около 60 разных сокровищ.

Иногда рассказчик комментирует находки игрока. Во многих случаях диалог можно увести чуть дальше, задав какой-нибудь вопрос о предмете. Например: 
- Чьи это носки?
- Зачем ему нужны рога?
- О чём эта пьесса?
- Почему этот камень скучный?

## Непредсказуемость

Когда игрок находится рядом с Вампусом и промахивается, Вампус начинает паниковать и перемещается в одну из трех своих соседних комнат. C вероятностью 33% он оказывается в одной комнате с игроком. В этом случае игрок либо умирает, либо перемещается в случайную комнату с помощью летучей мыши. Иногда это приводит к курьезным ситуациям:

![Почти удачное спасение](/images/posts/wumpus-escape-plan.jpg)<br>
*<sub>Почти удачное спасение</sub>*

1. Находясь в комнате 18, игрок услышал звуки Вампуса (из 19) и летучих мышей (из 9). Чтобы проверить обстановку, он стреляет в комнату 9.

2. Услышав звук выстрела, Вампус метнулся в одну из соседних комнат. По воле случая это оказалась комната с игроком (18).

3. Пролетавшая мимо летучая мышь схватила игрока и перенесла его в комнату 7.

4. К несчастью, в комнате 7 оказалась яма. 


## Достижения

Чтобы усилить эмоции от прохождения игры я добавил в неё ряд достижений. Некоторые из них отмечают прогресс игрока, а некоторые — особо курьезные моменты. Например:

* *Лентяй* — за победу не выходя из стартовой комнаты.
* *Неосмотрительный* — за падение в яму в первые три хода.
* *Мышелов* — за три перемещения на летучих мышах (при том, что в пещере их всего две).
* *Сброс балласта* — за падение в яму из-за летучей мыши.
* *Бумеранг* — за победу после чудесного спасения от Вампуса.

![Достижения](/images/posts/wumpus-achivments.jpg)<br>
*<sub>Достижения в конце игры</sub>*

Т.к. в основе игры лежит естественный диалог, я также добавил несколько ачивок, завязанных на репликах игрока:

* *Сапожник* — за оскорбление рассказчика (уменьшает итоговый счет).
* *Приятный собеседник* — за похвалу в адрес рассказчика. 
* *Почемучка* — за задавание вопросов и стремление узнать больше о мире игры.

## Удобство 

#### База знаний и подсказки

В любой момент игры пользователь может задать вопрос в свободной форме. Например:
- Как победить Вампуса?
- Для чего нужны сокровища?
- Сколько у меня осталось стрел?
- Почему дует сквозняк?
- Как узнать, где находится яма?
- Куда я могу пойти?
- Напомни номера комнат.

Последние две реплики незаменимы для игры без экрана, т.к. между озвучиванием номеров комнат и концом реплики ассистента проходит достаточно много времени — можно отвлечься и всё забыть.

![Ответы на вопросы](/images/posts/wumpus-smalltalk.jpg)<br>
*<sub>Ответы на вопросы игрока</sub>*

Через вопросы игрок может не только ориентироваться в пространстве, но и узнать чуть больше о мире игры:
- Кто такой Вампус?
- Откуда взялся Вампус?
- Что это за город?
- Что ты знаешь о летучих мышах?

#### Общие фразы
Рассказчик понимает реплики на общие темы: приветствие, прощание, грубость, похвалу и восторг. Если же он не сможет разобрать слова игрока, то деликатно попросит его перефразировать запрос.

#### Быстрые действия
Вместо того, чтобы нажимать кнопку «Огонь» и выбирать комнату, игрок может просто сказать «Стреляй в комнату 16!».

![Быстрая стрельба в обход интерфейса](/images/posts/wumpus-shortcut.jpg)<br>
*<sub>Стрельба голосом</sub>*

#### Запоминание
Игра помнит, сколько сессий провел игрок. Чем больше игр сыграно, тем короче становится приветственное сообщение (считаем, что пользователь уже разобрался в азах). 

После успешного завершения определенного количества сессий рассказчик предлагает оставить отзыв об игре. Чтобы не надоедать игроку, данное сообщение появляется только один раз за всё время.

Игра также ведёт учет ошибок распознавания (NoMatch). Если игрок столкнется с третьей ошибкой подряд, то вместо обычного «Извините, непонятно» рассказчик предложит ему вспомнить основные команды.

![Диалог помощи](/images/posts/wumpus-help.jpg)<br>
*<sub>Диалог из ошибки распознавания</sub>*

## Известные проблемы
По непонятным причинам игра изредка выдает сообщение «Диалог не отвечает». В&nbsp;этом случае просто скажите что-то вроде «Работай давай!» или «Запускайся!». Помогает в любом месте диалога.

----
<a href="https://dialogs.yandex.ru/store/skills/96f0d0b7-ohota-na-vampusa?utm_source=site&utm_medium=badge&utm_campaign=v1&utm_term=d1" target="_blank"><img alt="Алиса это умеет" src="https://dialogs.s3.yandex.net/badges/v1-term1.svg"/></a>